---
import { getAllPosts } from '../../utils/posts';

export async function getStaticPaths() {
  const posts = await getAllPosts();
  return posts.map((post) => ({
    params: { slug: post.slug },
  }));
}

const rawSlug = Astro.params.slug;
const slug = typeof rawSlug === 'string' ? rawSlug : '';
const targetPath = slug ? `/${slug}/` : '/';
const canonical = Astro.site ? new URL(targetPath, Astro.site).toString() : targetPath;
---

<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="refresh" content={`0; url=${targetPath}`} />
    <meta name="robots" content="noindex, follow" />
    <link rel="canonical" href={canonical} />
    <title>Redirectingâ€¦</title>
  </head>
  <body>
    <p>
      Redirecting to <a href={targetPath}>{canonical}</a>
    </p>
    <script is:inline define:vars={{ targetPath }}>
      window.location.replace(targetPath);
    </script>
  </body>
</html>
