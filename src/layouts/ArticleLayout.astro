---
import Layout from './Layout.astro';

interface Props {
  title: string;
  description?: string;
  keywords?: string;
  tags?: string[];
}

const { title, description, keywords, tags = [] } = Astro.props;
---

<Layout title={title} description={description} keywords={keywords}>
  <!-- 调整布局比例：主内容区占更大空间 -->
  <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">
    <!-- 主内容区 (占4份，更宽) -->
    <main class="lg:col-span-4">
      <!-- 面包屑导航 -->
      <nav class="text-sm mb-6 text-gray-600 border-b border-gray-200 pb-4">
        <a href="/" class="text-blue-600 hover:text-red-600 hover:underline">首页</a>
        <span class="mx-2">/</span>
        <span class="text-black font-medium">{title}</span>
      </nav>

      <!-- 文章标题 -->
      <h1 class="text-4xl font-bold mb-6 border-b-2 border-black pb-4 leading-tight">{title}</h1>

      <!-- 标签 -->
      {tags.length > 0 && (
        <div class="flex flex-wrap gap-2 mb-8">
          {tags.map(tag => (
            <a 
              href={`/tags/${tag}`} 
              class="text-xs text-gray-600 hover:text-gray-900 bg-gray-100 px-3 py-1 border border-gray-300 rounded-none hover:bg-gray-200 transition-colors"
            >
              #{tag}
            </a>
          ))}
        </div>
      )}

      <!-- 文章内容 -->
      <article class="prose prose-lg max-w-none">
        <slot />
      </article>
    </main>

    <!-- 侧边栏 (占1份，更窄) -->
    <aside class="lg:col-span-1 border-l-0 lg:border-l border-gray-200 lg:pl-6 space-y-8">
      <!-- 标签云 -->
      <div class="lg:sticky lg:top-4">
        <h3 class="font-bold border-b-2 border-black mb-4 pb-2 text-sm uppercase tracking-wider">
          标签
        </h3>
        <div id="tags-list" class="flex flex-wrap gap-x-2 gap-y-2 text-sm leading-relaxed text-gray-700">
          <!-- 标签将通过 JavaScript 动态加载 -->
        </div>
      </div>
    </aside>
  </div>
</Layout>

<style>
  /* 文章内容的样式优化 */
  :global(.prose) {
    color: #000;
    font-size: 18px;
    line-height: 1.8;
  }

  :global(.prose a) {
    color: #0000EE;
    text-decoration: none;
    transition: color 0.2s ease;
    word-break: break-word;
  }

  :global(.prose a:hover) {
    color: #FF0000;
    text-decoration: underline;
  }

  :global(.prose a:visited) {
    color: #551A8B;
  }

  :global(.prose h2) {
    font-size: 1.75em;
    font-weight: bold;
    margin-top: 1.5em;
    margin-bottom: 0.75em;
    border-bottom: 1px solid #ccc;
    padding-bottom: 0.5em;
    line-height: 1.3;
  }

  :global(.prose h3) {
    font-size: 1.4em;
    font-weight: bold;
    margin-top: 1.25em;
    margin-bottom: 0.5em;
    line-height: 1.3;
  }

  :global(.prose h4),
  :global(.prose h5),
  :global(.prose h6) {
    font-size: 1.15em;
    font-weight: bold;
    margin-top: 1em;
    margin-bottom: 0.5em;
  }

  :global(.prose p) {
    margin-bottom: 1.25em;
    font-size: 18px;
    line-height: 1.8;
  }

  :global(.prose ul),
  :global(.prose ol) {
    margin-left: 2em;
    margin-bottom: 1.25em;
  }

  :global(.prose li) {
    margin-bottom: 0.5em;
    font-size: 18px;
    line-height: 1.8;
  }

  /* 修复代码溢出问题 */
  :global(.prose code) {
    background-color: #f5f5f5;
    padding: 0.2em 0.4em;
    border-radius: 3px;
    font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
    font-size: 0.9em;
    color: #d63384;
    word-break: break-word;
    white-space: pre-wrap;
  }

  :global(.prose pre) {
    background-color: #f5f5f5;
    border: 1px solid #ccc;
    padding: 1.25em;
    overflow-x: auto;
    margin-bottom: 1.25em;
    border-radius: 4px;
    max-width: 100%;
  }

  :global(.prose pre code) {
    background-color: transparent;
    padding: 0;
    color: #000;
    font-size: 0.95em;
    word-break: normal;
    white-space: pre;
  }

  :global(.prose blockquote) {
    border-left: 4px solid #ccc;
    padding-left: 1.25em;
    margin-left: 0;
    margin-bottom: 1.25em;
    color: #666;
    font-style: italic;
  }

  :global(.prose table) {
    border-collapse: collapse;
    width: 100%;
    margin-bottom: 1.25em;
    font-size: 17px;
    overflow-x: auto;
    display: block;
  }

  :global(.prose th),
  :global(.prose td) {
    border: 1px solid #ccc;
    padding: 0.75em;
    text-align: left;
  }

  :global(.prose th) {
    background-color: #f5f5f5;
    font-weight: bold;
  }

  :global(.prose img) {
    max-width: 100%;
    height: auto;
    margin: 1.5em 0;
    border: 1px solid #ccc;
  }

  /* 移动端响应式 */
  @media (max-width: 768px) {
    :global(.prose) {
      font-size: 16px;
    }

    :global(.prose h2) {
      font-size: 1.5em;
    }

    :global(.prose h3) {
      font-size: 1.25em;
    }

    :global(.prose p) {
      font-size: 16px;
    }

    :global(.prose li) {
      font-size: 16px;
    }

    :global(.prose pre) {
      padding: 1em;
      font-size: 0.9em;
    }
  }
</style>

<script>
  // 加载所有标签
  async function loadTags() {
    try {
      const response = await fetch('/api/tags.json');
      const tags = await response.json();
      const tagsList = document.getElementById('tags-list');
      if (tagsList && tags.length > 0) {
        tagsList.innerHTML = tags.map((tag: string) => 
          `<a href="/tags/${tag}" class="text-blue-600 hover:text-red-600 hover:underline">[#${tag}]</a>`
        ).join('');
      }
    } catch (error) {
      console.error('Failed to load tags:', error);
    }
  }

  loadTags();
</script>
