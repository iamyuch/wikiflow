---
import Layout from './Layout.astro';

interface Props {
  title: string;
  description?: string;
  keywords?: string;
  tags?: string[];
}

const { title, description, keywords, tags = [] } = Astro.props;
---

<Layout title={title} description={description} keywords={keywords}>
  <!-- 双栏布局 -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
    <!-- 主内容区 (占3份) -->
    <main class="md:col-span-3">
      <!-- 面包屑导航 -->
      <nav class="text-sm mb-4 text-gray-600">
        <a href="/" class="hover:text-black">首页</a>
        <span class="mx-2">/</span>
        <span class="text-black">{title}</span>
      </nav>

      <!-- 文章标题 -->
      <h1 class="text-3xl font-bold mb-4 border-b-2 border-black pb-2">{title}</h1>

      <!-- 标签 -->
      {tags.length > 0 && (
        <div class="flex gap-2 mb-6">
          {tags.map(tag => (
            <a 
              href={`/tags/${tag}`} 
              class="text-xs text-gray-500 hover:text-gray-800 bg-gray-100 px-2 py-1 border border-gray-200 rounded-none"
            >
              #{tag}
            </a>
          ))}
        </div>
      )}

      <!-- 文章内容 -->
      <article class="prose prose-lg max-w-none">
        <slot />
      </article>
    </main>

    <!-- 侧边栏 (占1份) -->
    <aside class="md:col-span-1 border-l-0 md:border-l border-gray-200 md:pl-6 space-y-8">
      <!-- 标签云 -->
      <div>
        <h3 class="font-bold border-b-2 border-black mb-3 pb-1 text-sm uppercase tracking-wide">
          标签
        </h3>
        <div id="tags-list" class="flex flex-wrap gap-x-3 gap-y-1 text-sm leading-relaxed text-gray-700">
          <!-- 标签将通过 JavaScript 动态加载 -->
        </div>
      </div>
    </aside>
  </div>
</Layout>

<style>
  /* Prose 样式覆盖 */
  :global(.prose) {
    color: #000;
  }
  :global(.prose a) {
    color: #0000EE;
    text-decoration: none;
  }
  :global(.prose a:hover) {
    text-decoration: underline;
  }
  :global(.prose h2) {
    border-bottom: 1px solid #ccc;
    padding-bottom: 0.5rem;
    margin-top: 2rem;
  }
  :global(.prose code) {
    background-color: #f5f5f5;
    padding: 0.2rem 0.4rem;
    border-radius: 0;
    font-family: 'Courier New', Courier, monospace;
  }
  :global(.prose pre) {
    background-color: #f5f5f5;
    border: 1px solid #ccc;
  }
</style>

<script>
  // 加载所有标签
  async function loadTags() {
    try {
      const response = await fetch('/api/tags.json');
      const tags = await response.json();
      const tagsList = document.getElementById('tags-list');
      if (tagsList && tags.length > 0) {
        tagsList.innerHTML = tags.map((tag: string) => 
          `<a href="/tags/${tag}" class="text-link hover:text-link-hover hover:underline">[#${tag}]</a>`
        ).join('');
      }
    } catch (error) {
      console.error('Failed to load tags:', error);
    }
  }

  loadTags();
</script>
